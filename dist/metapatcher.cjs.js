"use strict";var t,e=require("basekits"),i=(t=require("dom-scripter"))&&"object"==typeof t&&"default"in t?t.default:t;function n(t){this.settings={},this.applySettings(t),this.set("meta","name",{name:"msapplication-config",content:"none"})}n.prototype.defaultSettings={structuredData:{enabled:!0},androidChromeIcons:{enabled:!0},msTags:{enabled:!0},safariTags:{enabled:!0},appleTags:{enabled:!0},openGraphTags:{enabled:!0},twitterTags:{enabled:!0},facebookTags:{enabled:!0}},n.prototype.mimeTypesByExtension={svg:"image/svg+xml",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",ico:"image/x-icon",gif:"image/gif",webp:"image/webp",bmp:"image/bmp"},n.prototype.prioritizeMethods=["preload","prefetch","preconnect","dns-prefetch"],n.prototype.validAndroidChromeIconSizes=["72x72","96x96","128x128","144x144","152x152","192x192","384x384","512x512"],n.prototype.validAppleTouchIconSizes=["120x120","180x180","152x152","167x167","1024x1024"],n.prototype.validMSTileIconSizes=["70x70","150x150","310x150","310x310"],n.prototype.mstilesNamingMap={"70x70":"msapplication-square70x70logo","150x150":"msapplication-square150x150logo","310x310":"msapplication-square310x310logo","310x150":"msapplication-wide310x150logo"},n.prototype.reImageSizeFromStr=/[0-9]{2,3}x[0-9]{2,3}/g,n.prototype.setFavicon=function(t){var i=this.findMimeType(t);if(!e.validationkit.isEmpty(i))return this.set("link","rel",{rel:"shortcut icon",href:t,type:i})},n.prototype.setProjectMeta=function(t){if(!e.validationkit.isEmpty(t))return e.validationkit.isNotEmpty(t.name)&&(this.settings.msTags.enabled&&this.set("meta","name",{name:"application-name",content:t.name}),this.settings.safariTags.enabled&&this.setSafariMobileWebApp({name:t.name}),this.settings.openGraphTags.enabled&&this.set("meta","property",{property:"og:site_name",content:t.name})),e.validationkit.isNotEmpty(t.url)&&this.settings.msTags.enabled&&this.set("meta","name",{name:"msapplication-starturl",content:t.url}),e.validationkit.isNotEmpty(t.logo)&&this.settings.structuredData.enabled&&i.injectJSONLD({"@type":"Organization",logo:t.logo,url:t.url},{"data-mptype":"sdorg"}),e.validationkit.isNotEmpty(t.primaryColor)&&this.set("meta","name",{name:"theme-color",content:t.primaryColor}),e.validationkit.isNotEmpty(t.backgroundColor)&&this.settings.msTags.enabled&&this.set("meta","name",{name:"msapplication-TileColor",content:t.backgroundColor}),this},n.prototype.robots=function(t){return this.set("meta","name",{name:"robots",content:t})},n.prototype.prioritize=function(t,e){if(-1!==this.prioritizeMethods.indexOf(e))return this.set("meta",void 0,{name:e,content:t})},n.prototype.removeAllPrioritizations=function(){for(var t=0;t<this.prioritizeMethods.length;t++){var i=this.prioritizeMethods[t],n=document.querySelectorAll('meta[name="'+i+'"]');if(e.validationkit.isNotEmpty(n))for(var o=0;o<n.length;o++)n[o].parentNode.removeChild(n[o])}return this},n.prototype.setIcons=function(t){var e=this,i=Object.values(e.mimeTypesByExtension);return t.map((function(t){var n=e.findMimeType(t),o=t.match(e.reImageSizeFromStr);if(o&&o.length>0&&n&&-1!==i.indexOf(n)){var a=o[0];-1!==e.validAndroidChromeIconSizes.indexOf(a)&&e.settings.androidChromeIcons.enabled&&e.set("link",void 0,{rel:"icon",href:t,sizes:a,type:n}),-1!==e.validAppleTouchIconSizes.indexOf(a)&&e.settings.appleTags.enabled&&e.set("link",void 0,{rel:"apple-touch-icon",href:t,sizes:a}),-1!==e.validMSTileIconSizes.indexOf(a)&&e.settings.msTags.enabled&&e.set("meta",void 0,{name:e.mstilesNamingMap[a],content:t})}})),e},n.prototype.setCanonical=function(t){return this.set("link",void 0,{rel:"canonical",href:t})},n.prototype.removeAllCanonicals=function(){var t=document.querySelectorAll('link[rel="canonical"]');if(e.validationkit.isNotEmpty(t))for(var i=0;i<t.length;i++)t[i].parentNode.removeChild(t[i]);return this},n.prototype.setLocalVersion=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.set("link",void 0,{rel:"alternate",href:e,hreflang:t}),this.settings.openGraphTags.enabled){var n=i?"":":alternate";this.set("meta",void 0,{property:"og:locale"+n,content:t})}return this},n.prototype.removeAllLocalVersions=function(){var t=document.querySelectorAll('link[rel="alternate"]');if(e.validationkit.isNotEmpty(t))for(var i=0;i<t.length;i++)elems2[i].parentNode.removeChild(elems2[i]);if(this.settings.openGraphTags.enabled){var n=document.querySelectorAll('meta[property="og:locale:alternate"]');if(e.validationkit.isNotEmpty(n))for(var o=0;o<n.length;o++)n[o].parentNode.removeChild(n[o]);var a=document.querySelector('meta[property="og:locale"]');e.validationkit.isNotEmpty(a)&&a.parentNode.removeChild(a)}return this},n.prototype.setPageMeta=function(t){if(e.validationkit.isEmpty(t))return this;if(e.validationkit.isNotEmpty(t.title)&&(document.title=t.title,this.settings.openGraphTags.enabled&&this.set("meta","property",{property:"og:title",content:t.title}),this.settings.twitterTags.enabled&&this.set("meta","name",{name:"twitter:title",content:t.title})),e.validationkit.isNotEmpty(t.description)&&(this.set("meta","name",{name:"description",content:t.description}),this.settings.openGraphTags.enabled&&this.set("meta","property",{property:"og:description",content:t.description}),this.settings.twitterTags.enabled&&this.set("meta","name",{name:"twitter:description",content:t.description})),e.validationkit.isNotEmpty(t.url)&&this.settings.openGraphTags.enabled&&this.set("meta","property",{property:"og:url",content:t.url}),e.validationkit.isNotEmpty(t.image)){var i=this.formatImageInput(t.image);this.settings.openGraphTags.enabled&&(this.set("meta","property",{property:"og:image",content:i.url}),e.validationkit.isNotEmpty(i.width)&&this.set("meta","property",{property:"og:image:width",content:i.width}),e.validationkit.isNotEmpty(i.height)&&this.set("meta","property",{property:"og:image:height",content:i.height})),this.settings.twitterTags.enabled&&this.set("meta","name",{name:"twitter:image",content:i.url})}return e.validationkit.isNotEmpty(t.locale)&&(document.querySelector("html").setAttribute("lang",t.locale),this.settings.openGraphTags.enabled&&this.set("meta","property",{property:"og:locale",content:t.locale.replace("-","_")})),this},n.prototype.setSafariMobileWebApp=function(t){return this.settings.appleTags.enabled?(this.set("meta","name",{name:"apple-mobile-web-app-capable",content:"yes"}),e.validationkit.isNotEmpty(t.name)&&this.set("meta","name",{name:"apple-mobile-web-app-title",content:t.name}),e.validationkit.isNotEmpty(t.statusBarStyle)&&this.set("meta","name",{name:"apple-mobile-web-app-status-bar-style",content:t.statusBarStyle}),this):this},n.prototype.setSafariPinnedTab=function(t,e){return this.set("link","rel",{rel:"mask-icon",href:t,color:e||"black"})},n.prototype.setFacebookMeta=function(t){return e.validationkit.isNotEmpty(t.appID)&&this.set("meta","property",{property:"fb:app_id",content:t.appID}),this},n.prototype.setTwitterMeta=function(t){if(!this.settings.twitterTags.enabled)return this;e.validationkit.isNotEmpty(t.card)&&this.set("meta","name",{name:"twitter:card",content:t.card}),e.validationkit.isNotEmpty(t.site)&&this.set("meta","name",{name:"twitter:site",content:t.site}),e.validationkit.isNotEmpty(t.creator)&&this.set("meta","name",{name:"twitter:creator",content:t.creator})},n.prototype.breadcrumb=function(t){if(!this.settings.structuredData.enabled)return this;var e={"@type":"BreadcrumbList",itemListElement:t.map((function(t,e){return{"@type":"ListItem",position:e+1,name:t.title,item:t.url}}))};return i.injectJSONLD(e,{"data-mptype":"sdb"}),this},n.prototype.formatImageInput=function(t){return e.typekit.isString(t)?{url:t}:e.typekit.isObject(t)?{url:t.url,width:t.width,height:t.height}:{}},n.prototype.findMimeType=function(t){var i=t.lastIndexOf(".");if(!(i<1)){var n=t.slice(i+1);if(!e.validationkit.isEmpty(n))return e.objectkit.getProp(this.mimeTypesByExtension,n,void 0)}},n.prototype.set=function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.validationkit.isNotEmpty(i)){var o=this.hasElement(t+"["+i+'="'+n[i]+'"]');o&&o.parentNode.removeChild(o)}var a=this.createElement(t,n);return this.patch(a),a},n.prototype.hasElement=function(t){return document.querySelector(t)},n.prototype.createElement=function(t,i){var n=document.createElement(t);return e.typekit.isObject(i)&&Object.keys(i).map((function(t){return n.setAttribute(t,i[t])})),n},n.prototype.patch=function(t){document.getElementsByTagName("head")[0].insertBefore(t,null)},n.prototype.applySettings=function(t){var i=this.defaultSettings;this.settings=Object.keys(this.defaultSettings).reduce((function(n,o){return n[o]=e.objectkit.getProp(t,o,e.objectkit.getProp(i,o,{})),n}),{})},module.exports=n;
